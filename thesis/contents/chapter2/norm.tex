\subsection{Нормальная форма программы на \miniKanren{}}

Любое отношение \miniKanren{} можно преобразовать в нормальную форму.
\emph{Нормальной формой} будем называть дизъюнкцию конъюнкций вызовов отношений или унификаций термов, в которой все свободные переменные введены в область видимости в самом начале; при этом отсутствуют унификации двух конструкторов.
Соответствующий абстрактный синтаксис приведен на рисунке~\ref{fig:normmk}.

\begin{figure}
    \begin{align*}
      Goal  &: \underline{fresh} \ [Name] \ (\bigvee \bigwedge Goal') \\
      Goal' &: \underline{call} \ Name \ [Var] \\
            &\mid Var \equiv Term \\
            &\mid Term \equiv Var \\
      Term  &: Var \\ 
            &\mid \underline{cons} \ Name \ [Term]
    \end{align*}
    \caption{Абстрактный синтаксис нормализованной программы на \miniKanren{}}
    \label{fig:normmk}
\end{figure}

Приведём отличия нормализованной программы от ненормализованной.
Для каждого из них обсудим причины появления и способ получения из ненормализованной формы.
\begin{itemize}
    \item Тело определения находится в ДНФ;
    \item $fresh$-цель одна на самом верхнем уровне;
    \item Не существует унификаций термов-конструкторов;
    \item Не существует вызовов на термах-конструкторах;
\end{itemize}

Такие ограничения вводятся с целью упрощения процесса аннотирования и трансляции в целом:
\begin{itemize}
    \item ДНФ тела позволяет уменьшить глубину вложенности программы;
    \item $fresh$-цель задаёт скоуп вычислений и позволяет использовать одинаковые имена переменных в различных скоупах --- её наличие только на верхнем уровне означает, что все переменные находятся в одном скоупе и на всю программу существует только один скоуп;
    \item Отсутствие унификаций термов-конструкторов позволяет не производить очевидной унификации в процессе выполнения алгоритма;
    \item Отсутствие вызовов на термах-конструкторах позволяет избежать неопределённости в процессе аннотирования;
\end{itemize}

Если в программе на \miniKanren{} отсутствуют вызовы на термах-конструкторах, то привести её к core-\miniKanren{} несложно:
\begin{itemize}
    \item Приведение булевого выражения в ДНФ --- тривиальная задача;
    \item Если уникально переименовать все $fresh$-переменные отношения, то fresh-цель можно оставить только на самом верхнем уровне, избежав перекрытия имён;
    \item Унификацию термов-конструкторов, если совпадают их имена и количество аргументов, всегда можно заменить на унификацию переменной и терма;
    \item Способ аннотирования программ с вызовами на термах-конструкторах рассматривается в подчастях описания алгоритма;
\end{itemize}

